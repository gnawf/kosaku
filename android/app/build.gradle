def localProperties = new Properties()
def localPropertiesFile = rootProject.file('local.properties')
if (localPropertiesFile.exists()) {
  localPropertiesFile.withReader('UTF-8') { reader ->
    localProperties.load(reader)
  }
}

def flutterRoot = localProperties.getProperty('flutter.sdk')
if (flutterRoot == null) {
  throw new GradleException("Flutter SDK not found. Define location with flutter.sdk in the local.properties file.")
}

def flutterVersionCode = localProperties.getProperty('flutter.versionCode')
if (flutterVersionCode == null) {
  throw new GradleException("versionCode not found. Define flutter.versionCode in the local.properties file.")
}

def flutterVersionName = localProperties.getProperty('flutter.versionName')
if (flutterVersionName == null) {
  throw new GradleException("versionName not found. Define flutter.versionName in the local.properties file.")
}

apply plugin: 'com.android.application'
apply from: "$flutterRoot/packages/flutter_tools/gradle/flutter.gradle"

android {
  compileSdkVersion 27

  lintOptions {
    disable 'InvalidPackage'
  }

  defaultConfig {
    applicationId "com.gnawf.kosaku"
    minSdkVersion 16
    targetSdkVersion 27
    versionCode 1
    versionName "1.0.0"
    testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner"
  }

  def keyStorePropertiesFile = new File("/Volumes/Signatures/kosaku.properties")

  if (keyStorePropertiesFile.exists()) {
    def keyStoreProperties = new Properties()
    def keyStoreInStream = new FileInputStream(keyStorePropertiesFile)
    keyStoreProperties.load(keyStoreInStream)
    keyStoreInStream.close()

    signingConfigs {
      release {
        keyAlias keyStoreProperties["keyAlias"]
        keyPassword keyStoreProperties["keyPassword"]
        storeFile file(keyStoreProperties["storeFile"])
        storePassword keyStoreProperties["storePassword"]
      }
    }
    buildTypes {
      release {
        signingConfig signingConfigs.release
      }
    }
  }
}

flutter {
  source '../..'
}

dependencies {
  testImplementation 'junit:junit:4.12'
  androidTestImplementation 'com.android.support.test:runner:1.0.2'
  androidTestImplementation 'com.android.support.test.espresso:espresso-core:3.0.2'
}
